<!DOCTYPE html>
{% autoescape true %}
<html>
  <head>
	<link type="text/css" rel="stylesheet" href="/stylesheets/main.css" />
	<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
  </head>
  <body>
	<h1>Towers' Event Hosting Web Page</h1>

	<form id="eventCreationForm" action="/event_creation" method="post">
	  <h2>Create a new Event:</h2>
	  <br>
	  <label>Event Name:</label>
	  <input type="text" id ="eventCreationName" name="eventName">
	  <br>

	  <label>Event Capacity:</label>
	  <input type="text" id ="eventCreationCapacity" name="eventCapacity">
	  <br>

	  <input type="submit" value="Add Event">
	</form>

	<hr>

	<form id="eventManagementForm" action="/event_management" method="post">
	  <label>Choose an event: </label>
	  <select id="eventDropdown" onchange="updateSelectedEventData()">
		<option value="" disabled selected style="display:none;">-</option>
		{% for event in events %}
		<option value="{{event.name}}">{{event.name}}</option>
		{% endfor %}
	  </select>

		{% for guests in guests_list %}
		<h3> Table: {{guests[0]}} </h3>
		<table id="table{{guests[0]}}" border="1">
			<tr>
				<th> Guest Name </th>
				<th> Guest Surname </th>
			</tr>
			{% for guest in guests[1] %}
			<tr>
				<td> {{ guest.name }} </td>
				<td> {{ guest.surname }} </td>
			</tr>
			{% endfor %}
		</table>
		{% endfor %}
			
	  <br>

	  <label id="eventCapacity">Event Capacity: 0</label>
	  <br>
	  <label id="eventGuests">Suscribed Guests: 0</label>
	</form>

	<hr>

	  <form id="guestsForm" action="/add_guest" method="post">
		<h3 id ="guestsFormTitle"></h3>
		<label>Name:</label>
		<input type="text" id="guestName" name="guestName">
		<br>

		<label>Surname:</label>
		<input type="text" id="guestSurname" name="guestSurname">
		<br>

		<label>E-Mail:</label>
		<input type="text" id="guestEmail" name="guestEmail">
		<br>

		<label>Company:</label>
		<input type="text" id="guestCompany" name="guestCompany">
		<br>

		<input type="submit" value="Join">
	  </form>

	<hr>

	<!-- This is a F5 button like. I don't know if this is correct,
	but it works for me at least -->
	<form id="dataUpdater" action="/updater" method="post">
		<input type="submit" value="Update Event Page">
	</form>


	<!-- JQuery scripts -->
	<script>
		$(function() {
			var guestsForm = $("#guestsForm");
			guestsForm.hide();
		});

		$("#guestsForm").submit(function(event) {
			event.preventDefault();

			var url = $(this).attr("action");
			var actualEvent = $("select#eventDropdown").val();
			var data = $(this).serializeArray();
			data.push( {name: "actualEvent", value: actualEvent} );
			$.post(url, data);

			// Erase all the value of the text of guestForm
			$("#guestName").val('')
			$("#guestSurname").val('')
			$("#guestEmail").val('')
			$("#guestCompany").val('')
		});

		$("#eventCreationForm").submit(function(event) {
			var name = $("#eventCreationName").val();
			if (name == "") {
				alert("Event name must not be empty");
				return;
			}

			var capacity = $("#eventCreationCapacity").val();
			if (capacity == "") {
				alert("Event capacity must not be empty");
				event.preventDefault();
				return;
			}

			if ($.isNumeric(capacity) != true) {
				alert("Event capacity must be a number");
				event.preventDefault();
			}
		});
	</script>

	<script type="text/javascript">
	  function updateSelectedEventData() {
		var e = document.getElementById("eventDropdown");
		var value = e.options[e.selectedIndex].value;

		if (value != "-") {
			$("#guestsForm").show();
			document.getElementById("guestsFormTitle").innerHTML = 
				value + " Event";
		}

		{% for event in events %}
		  if (value == "{{event.name}}") {
			document.getElementById("eventCapacity").innerHTML
			  = 'Event Capacity: ' + "{{event.capacity}}";
			document.getElementById("eventGuests").innerHTML
			  = 'Suscribed Guests: ' + "{{event.guests}}";
		  }

		{% endfor %}

		return;
	  }
	</script>

  </body>
</html>
{% endautoescape %}
